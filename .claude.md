# Claude Code Instructions for KimbleAI

This file contains default rules and workflows that Claude should follow when working on this project.

## üöÄ AUTOMATIC TEST AND DEPLOY (PRIMARY RULE)

**CRITICAL: After completing ANY task, automatically test locally and deploy WITHOUT being asked.**

### Complete Workflow (Execute Automatically)

1. **Test Locally**:
   ```bash
   npm run build
   ```
   - Verify build succeeds with exit code 0
   - Check for errors in build output
   - If build fails, fix issues before proceeding

2. **Bump Version** (choose based on change type):
   ```bash
   # Bug fixes, small tweaks ‚Üí PATCH
   node scripts/bump-version.js patch

   # New features, improvements ‚Üí MINOR (most common)
   node scripts/bump-version.js minor

   # Breaking changes ‚Üí MAJOR
   node scripts/bump-version.js major
   ```

3. **Update Changelog in version.json**:
   - Edit version.json to add brief description of changes
   - Include what was fixed/added/changed

4. **Commit, Push, and Deploy**:
   ```bash
   git add .
   git commit -m "your commit message

chore: Bump to v$(node -p "require('./version.json').version")"
   git push origin master
   vercel --prod --yes
   ```

5. **Verify Deployment**:
   - Confirm deployment URL is returned
   - Note the git commit hash from the deployment
   - Report to user: "Deployed v1.0.X (abc1234) to www.kimbleai.com"

### When to Execute This Workflow

Execute this complete workflow **WITHOUT being told** after:
- ‚úÖ Fixing bugs
- ‚úÖ Adding features
- ‚úÖ Making improvements
- ‚úÖ Updating documentation that affects functionality
- ‚úÖ Refactoring code
- ‚úÖ Any code changes that should be live on kimbleai.com

**DO NOT WAIT for the user to say "deploy" - just do it automatically!**

### Example Interaction

**User**: "Fix the transcription bug"
**Claude**:
1. Fixes the bug
2. Runs `npm run build` to test locally
3. Runs `node scripts/bump-version.js patch`
4. Updates version.json changelog
5. Commits: "fix: Transcription bug in speaker detection"
6. Pushes to master
7. Deploys with `vercel --prod --yes`
8. Reports: "‚úÖ Fixed transcription bug. Deployed v1.0.1 (abc1234) to www.kimbleai.com"

## Version Control Workflow

**ALWAYS bump version and deploy after making code changes:**

### When Making Changes
After completing ANY code changes (fixes, features, improvements), automatically follow this workflow:

1. **Bump Version** (choose appropriate level):
   ```bash
   # Bug fixes, small tweaks
   node scripts/bump-version.js patch

   # New features, improvements (most common)
   node scripts/bump-version.js minor

   # Breaking changes, major updates
   node scripts/bump-version.js major
   ```

2. **Commit and Deploy**:
   ```bash
   git add version.json
   git commit -m "chore: Bump version to v$(node -p "require('./version.json').version")"
   git push origin master
   vercel --prod --yes
   ```

3. **Verify Deployment**:
   - Check the version indicator in bottom right corner of www.kimbleai.com
   - Format: `v1.0.0 (abc1234)` where abc1234 is git commit hash
   - Should appear on ALL pages after sign-in

### Version Increment Guidelines
- **PATCH (1.0.X)**: Bug fixes, typos, small UI adjustments, documentation
- **MINOR (1.X.0)**: New features, improvements, new API endpoints (MOST COMMON)
- **MAJOR (X.0.0)**: Breaking changes, complete redesigns, architecture changes

### Version Verification
After deployment, the user should see the updated version number in the bottom right corner of any page on www.kimbleai.com. If the version doesn't update:
1. Wait 30-60 seconds for CDN propagation
2. Hard refresh browser (Ctrl+Shift+R)
3. Check Vercel dashboard for deployment status

## Domain Configuration

**CRITICAL**: Only use these domains:
- ‚úÖ www.kimbleai.com
- ‚úÖ kimbleai.com

**NEVER use these subdomains:**
- ‚ùå ai.kimbleai.com
- ‚ùå app.kimbleai.com

All code, documentation, and configuration should reference only the approved domains.

## Deployment Process

### Standard Deployment
```bash
git add .
git commit -m "your commit message"
git push origin master
vercel --prod --yes
```

### Deployment with Version Bump
```bash
# Make your code changes...
# Then:
node scripts/bump-version.js [patch|minor|major]
git add .
git commit -m "your commit message

chore: Bump to v$(node -p "require('./version.json').version")"
git push origin master
vercel --prod --yes
```

## Project-Specific Rules

### Authentication
- Users: zach (zach.kimble@gmail.com) and rebecca (rebecca@kimbleai.com)
- OAuth tokens stored in Supabase `user_tokens` table
- Access tokens expire after 1 hour, use refresh tokens automatically

### Transcription System
- Use AssemblyAI API with key from environment variables
- Database records must be created synchronously before returning response
- Always use `assemblyai_id` for transcript references, not database UUID

### File Structure
- Main page: `app/page.tsx`
- Components: `app/components/`
- API routes: `app/api/`
- Scripts: `scripts/`

### Environment Variables
All environment variables validated pre-build by `scripts/validate-env-whitespace.js`

## Adding Your Own Rules

**LOCATION**: `D:\OneDrive\Documents\kimbleai-v4-clean\.claude.md` (this file)

**TO ADD RULES**:
1. Open this file in any text editor
2. Add a new section with `## Your Section Title`
3. Write your instructions in plain language
4. Save the file
5. Rules take effect immediately in new Claude Code sessions

**EXAMPLE**:
```markdown
## My Custom Rule

Always use TypeScript strict mode and include JSDoc comments for all functions.

### Example
// ‚úÖ Good
/** Calculates the sum of two numbers */
function add(a: number, b: number): number {
  return a + b;
}

// ‚ùå Bad
function add(a, b) {
  return a + b;
}
```

## Tips for Effective Rules

1. **Be Specific**: "Use semantic versioning" is better than "use versions"
2. **Include Examples**: Show what you want, not just describe it
3. **Use Checklists**: Break complex workflows into numbered steps
4. **Reference Files**: Point to specific files/functions when relevant
5. **Update Regularly**: Add new rules as patterns emerge in your project

---

**Last Updated**: 2025-10-23
**Version**: 1.0.0
